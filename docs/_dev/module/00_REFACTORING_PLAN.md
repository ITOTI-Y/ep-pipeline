# EP-WebUI é‡æ„å®æ–½è®¡åˆ’

> Comprehensive Refactoring Implementation Plan
>
> ç‰ˆæœ¬ï¼š2.0
> æ›´æ–°æ—¥æœŸï¼š2025-10-27
> åŸºäºï¼šé¢å‘å¯¹è±¡è®¾è®¡ã€æœ€æ–°APIã€å®Œå…¨é‡å†™

---

## ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
3. [å½“å‰çŠ¶æ€åˆ†æ](#å½“å‰çŠ¶æ€åˆ†æ)
4. [é‡æ„ç›®æ ‡](#é‡æ„ç›®æ ‡)
5. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
6. [æ¶æ„è®¾è®¡æ¦‚è§ˆ](#æ¶æ„è®¾è®¡æ¦‚è§ˆ)
7. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)
8. [å„é˜¶æ®µè¯¦ç»†è®¡åˆ’](#å„é˜¶æ®µè¯¦ç»†è®¡åˆ’)
9. [è´¨é‡ä¿è¯](#è´¨é‡ä¿è¯)
10. [é£é™©ç®¡ç†](#é£é™©ç®¡ç†)
11. [æ–‡æ¡£ç»“æ„](#æ–‡æ¡£ç»“æ„)
12. [æˆåŠŸæ ‡å‡†](#æˆåŠŸæ ‡å‡†)

---

## æ‰§è¡Œæ‘˜è¦

EP-WebUI æ˜¯ä¸€ä¸ªåŸºäº EnergyPlus çš„å»ºç­‘èƒ½æºæ¨¡æ‹Ÿå’Œä¼˜åŒ–æ¡†æ¶ã€‚æœ¬é‡æ„è®¡åˆ’å°†é¡¹ç›®ä»è¿‡ç¨‹å¼ç¼–ç¨‹å®Œå…¨é‡å†™ä¸ºé¢å‘å¯¹è±¡æ¶æ„ï¼Œé‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ã€SOLIDåŸåˆ™å’Œæœ€æ–°çš„Pythonæœ€ä½³å®è·µã€‚

### æ ¸å¿ƒæ”¹è¿›

| ç»´åº¦ | å½“å‰çŠ¶æ€ | ç›®æ ‡ | é¢„æœŸæå‡ |
|------|---------|------|---------|
| **ä»£ç è´¨é‡** | è¿‡ç¨‹å¼ï¼Œä½å†…èš | OOPï¼Œé«˜å†…èšä½è€¦åˆ | è´¨é‡æå‡ 5x |
| **ç±»å‹å®‰å…¨** | ~20% ç±»å‹æç¤º | 100% ç±»å‹æç¤º | æå‡ 400% |
| **æµ‹è¯•è¦†ç›–** | 0% | 80%+ | +80% |
| **æ‰§è¡Œæ€§èƒ½** | é¡ºåºæ‰§è¡Œ | å¹¶è¡Œæ‰§è¡Œ 4-8x | æå‡ 300-700% |
| **å¯ç»´æŠ¤æ€§** | ä½ï¼ˆæ— æ–‡æ¡£ï¼‰ | é«˜ï¼ˆå®Œæ•´æ–‡æ¡£ï¼‰ | æå‡ 10x |
| **æ‰©å±•æ€§** | å›°éš¾ | æ’ä»¶åŒ– | è´¨çš„é£è·ƒ |

### æ—¶é—´è¡¨

- **æ€»æ—¶é•¿**: 12 å‘¨
- **é‡Œç¨‹ç¢‘**: 6 ä¸ªä¸»è¦é˜¶æ®µ
- **äº¤ä»˜ç‰©**: 9 ä¸ªè¯¦ç»†å®æ–½æ–‡æ¡£ + å®Œæ•´é‡æ„ä»£ç 

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ä½¿å‘½

ä¸ºå»ºç­‘èƒ½æºç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆæä¾›é«˜æ•ˆã€å¯é ã€æ˜“æ‰©å±•çš„å»ºç­‘èƒ½æºæ¨¡æ‹Ÿå’Œä¼˜åŒ–å¹³å°ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **å»ºç­‘èƒ½æºæ¨¡æ‹Ÿ**
   - åŸºå‡†å»ºç­‘æ¨¡æ‹Ÿï¼ˆBaselineï¼‰
   - å…‰ä¼ç³»ç»Ÿæ¨¡æ‹Ÿï¼ˆPVï¼‰
   - èƒ½æ•ˆæªæ–½æ¨¡æ‹Ÿï¼ˆECMï¼‰
   - æœªæ¥æ°”å€™æƒ…æ™¯æ¨¡æ‹Ÿï¼ˆFTMYï¼‰

2. **èƒ½æºä¼˜åŒ–**
   - å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆé—ä¼ ç®—æ³•ã€è´å¶æ–¯ä¼˜åŒ–ã€ç²’å­ç¾¤ç®—æ³•ï¼‰
   - æ•æ„Ÿæ€§åˆ†æï¼ˆSobolã€Morrisï¼‰
   - å‚æ•°åŒ–åˆ†æ

3. **æ•°æ®åˆ†æ**
   - EUIï¼ˆèƒ½è€—å¼ºåº¦ï¼‰è®¡ç®—å’Œé¢„æµ‹
   - èƒ½è€—åˆ†è§£åˆ†æ
   - ç»“æœå¯è§†åŒ–å’Œå¯¼å‡º

4. **æ‰¹å¤„ç†èƒ½åŠ›**
   - å¤šå»ºç­‘æ‰¹é‡æ¨¡æ‹Ÿ
   - å¤šæƒ…æ™¯å¹¶è¡Œåˆ†æ
   - è¿›åº¦è·Ÿè¸ªå’Œé”™è¯¯å¤„ç†

### åˆ©ç›Šç›¸å…³è€…

- **ç ”ç©¶äººå‘˜**: éœ€è¦å¯é çš„æ¨¡æ‹Ÿç»“æœå’Œçµæ´»çš„åˆ†æå·¥å…·
- **å¼€å‘è€…**: éœ€è¦æ¸…æ™°çš„æ¶æ„å’Œè‰¯å¥½çš„æ–‡æ¡£
- **è¿ç»´äººå‘˜**: éœ€è¦ç¨³å®šçš„ç³»ç»Ÿå’Œæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯

---

## å½“å‰çŠ¶æ€åˆ†æ

### ä»£ç åº“ç°çŠ¶

```text
EP-WebUI/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ configs/          # âœ… é…ç½®æ–‡ä»¶ï¼ˆOmegaConfï¼‰
â”‚   â”œâ”€â”€ services/         # âš ï¸ åŸºç¡€æœåŠ¡ï¼ˆè¿‡äºç®€å•ï¼‰
â”‚   â”‚   â”œâ”€â”€ base_services.py
â”‚   â”‚   â””â”€â”€ baseline_services.py
â”‚   â”œâ”€â”€ utils/            # âš ï¸ å·¥å…·ç±»ï¼ˆç¼ºå°‘ç±»å‹æç¤ºï¼‰
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ logger.py
â”‚   â”œâ”€â”€ simulate_manager.py  # âŒ èŒè´£ä¸æ¸…æ™°
â”‚   â””â”€â”€ data/             # âœ… æ•°æ®æ–‡ä»¶
â”œâ”€â”€ main.py               # âŒ è¿‡ç¨‹å¼ç¼–ç¨‹
â”œâ”€â”€ archive/              # æ—§ä»£ç 
â””â”€â”€ tests/                # âŒ æ²¡æœ‰æµ‹è¯•
```

### ä¸»è¦é—®é¢˜

#### 1. æ¶æ„é—®é¢˜

**âŒ è¿‡ç¨‹å¼ç¼–ç¨‹**
```python
# main.py - å½“å‰ä»£ç 
def main():
    for city in CITIES:
        for building_type in BUILDING_TYPES:
            for idf_file in all_idf_files:
                if city in idf_file.stem and building_type in idf_file.stem:
                    pending_idf_files.append(idf_file)

    for idf_file in pending_idf_files:
        for weather_file in pending_weather_files:
            manager = SimulateManager(config, idf_file, weather_file)
            manager.simulate()
```

**é—®é¢˜**:
- ç¡¬ç¼–ç çš„å¾ªç¯é€»è¾‘
- ç¼ºä¹é¢†åŸŸæ¨¡å‹ï¼ˆBuilding, WeatherFileï¼‰
- æ²¡æœ‰æ‰¹å¤„ç†ç¼–æ’
- æ— æ³•å¹¶è¡Œæ‰§è¡Œ

#### 2. ç±»å‹å®‰å…¨é—®é¢˜

**âŒ ç¼ºå°‘ç±»å‹æç¤º**
```python
# current code
class BaseService(ABC):
    def __init__(self, config: Config, idf: IDF):  # âœ… æœ‰ç±»å‹æç¤º
        self._idf = idf
        self._config = config
        self._logger = logger  # âŒ logger æ²¡æœ‰ç±»å‹

    @abstractmethod
    def run(self, weather_file, output_dir, read_vars=False, output_prefix=None):
        # âŒ å‚æ•°ç¼ºå°‘ç±»å‹æç¤º
        pass
```

#### 3. é…ç½®ç®¡ç†é—®é¢˜

**âŒ ä¸å®‰å…¨çš„åŠ¨æ€å±æ€§è®¿é—®**
```python
# utils/config.py
class Config:
    def __getattr__(self, name: str) -> Any:
        # âŒ è¿è¡Œæ—¶æ‰èƒ½å‘ç°é…ç½®é”™è¯¯
        try:
            return object.__getattribute__(self, name)
        except AttributeError:
            raise AttributeError(...)

# ä½¿ç”¨æ—¶
baseline_service.run(
    weather_file=self.config.paths.fmt,  # âŒ 'fmt' æ˜¯å¦å­˜åœ¨ï¼Ÿè¿è¡Œæ—¶æ‰çŸ¥é“
    output_dir=self.config.paths.baseline_dir,
)
```

#### 4. é”™è¯¯å¤„ç†é—®é¢˜

**âŒ ç¼ºå°‘å¼‚å¸¸å±‚æ¬¡ç»“æ„**
- æ²¡æœ‰è‡ªå®šä¹‰å¼‚å¸¸ç±»
- é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†
- æ— æ³•åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯

#### 5. æµ‹è¯•é—®é¢˜

**âŒ å®Œå…¨æ²¡æœ‰æµ‹è¯•**
- æ— å•å…ƒæµ‹è¯•
- æ— é›†æˆæµ‹è¯•
- ä»£ç æ›´æ”¹é£é™©é«˜

---

## é‡æ„ç›®æ ‡

### ä¸»è¦ç›®æ ‡

#### 1. ä»£ç è´¨é‡ç›®æ ‡

**ç±»å‹å®‰å…¨**
- âœ… 100% ç±»å‹æç¤ºè¦†ç›–
- âœ… ä½¿ç”¨ Pydantic v2 è¿›è¡Œæ•°æ®éªŒè¯
- âœ… ä½¿ç”¨ mypy è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥

**ä»£ç ç»„ç»‡**
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ˆDomain, Service, Infrastructure, Applicationï¼‰
- âœ… å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰
- âœ… ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰

**æ–‡æ¡£åŒ–**
- âœ… 90%+ æ–‡æ¡£å­—ç¬¦ä¸²è¦†ç›–
- âœ… Google é£æ ¼æ–‡æ¡£
- âœ… è¯¦ç»†çš„ API æ–‡æ¡£

#### 2. æ€§èƒ½ç›®æ ‡

**æ‰§è¡Œæ•ˆç‡**
- âœ… å¹¶è¡Œæ‰§è¡Œï¼š4-8 ä¸ªå·¥ä½œè¿›ç¨‹
- âœ… æ™ºèƒ½ç¼“å­˜ï¼šå†…å­˜ + ç£ç›˜
- âœ… å¯¹è±¡æ± åŒ–ï¼šé‡ç”¨ IDF å¯¹è±¡

**é¢„æœŸæå‡**
| åœºæ™¯ | å½“å‰æ—¶é—´ | ç›®æ ‡æ—¶é—´ | æå‡ |
|------|---------|---------|------|
| å•ä¸ªæ¨¡æ‹Ÿ | 60s | 50s | 17% |
| 10ä¸ªæ¨¡æ‹Ÿï¼ˆé¡ºåºï¼‰ | 600s | 150s | 75% |
| 100ä¸ªæ¨¡æ‹Ÿï¼ˆé¡ºåºï¼‰ | 6000s | 800s | 87% |

#### 3. å¯ç»´æŠ¤æ€§ç›®æ ‡

**æµ‹è¯•è¦†ç›–**
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

**ä»£ç è´¨é‡æŒ‡æ ‡**
- âœ… åœˆå¤æ‚åº¦ < 10
- âœ… å¹³å‡æ–¹æ³•é•¿åº¦ < 20 è¡Œ
- âœ… ä»£ç é‡å¤ç‡ < 3%

#### 4. å¯æ‰©å±•æ€§ç›®æ ‡

**æ’ä»¶åŒ–**
- âœ… å·¥å‚æ¨¡å¼ï¼šåŠ¨æ€åˆ›å»ºæœåŠ¡
- âœ… ç­–ç•¥æ¨¡å¼ï¼šå¯æ’æ‹”ç®—æ³•
- âœ… è§‚å¯Ÿè€…æ¨¡å¼ï¼šäº‹ä»¶ç›‘å¬

**æ–°åŠŸèƒ½æ·»åŠ **
- æ·»åŠ æ–°æ¨¡æ‹Ÿç±»å‹ï¼šæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- æ·»åŠ æ–°ä¼˜åŒ–ç®—æ³•ï¼šå®ç°ç­–ç•¥æ¥å£å³å¯
- æ·»åŠ æ–°æ•°æ®æºï¼šå®ç°ä»“å‚¨æ¥å£å³å¯

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯

#### Python 3.12+
- ä½¿ç”¨æœ€æ–° Python ç‰¹æ€§
- ç±»å‹æç¤ºï¼ˆType Hintsï¼‰
- æ•°æ®ç±»ï¼ˆDataclassesï¼‰
- æ¨¡å¼åŒ¹é…ï¼ˆMatch-Caseï¼‰

#### æ•°æ®éªŒè¯
```toml
[tool.poetry.dependencies]
pydantic = "^2.5"  # æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
```

#### EnergyPlus é›†æˆ
```toml
eppy = "^0.5"     # IDF æ–‡ä»¶å¤„ç†
geomeppy = "^0.11.8"  # å‡ ä½•æ“ä½œï¼ˆå¯é€‰ï¼‰
```

#### é…ç½®ç®¡ç†
```toml
omegaconf = "^2.3"  # å±‚æ¬¡åŒ–é…ç½®
pydantic-settings = "^2.1"  # ç¯å¢ƒå˜é‡æ”¯æŒ
```

#### æ—¥å¿—ç³»ç»Ÿ
```toml
loguru = "^0.7"   # ç®€æ´å¼ºå¤§çš„æ—¥å¿—
```

#### å¹¶è¡Œå¤„ç†
```toml
joblib = "^1.3"  # å¹¶è¡Œå¤„ç†åº“
```

#### ç¼“å­˜
```toml
diskcache = "^5.6"  # ç£ç›˜ç¼“å­˜
redis = "^5.0"      # Redis ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
```

#### æµ‹è¯•
```toml
pytest = "^7.4"
pytest-cov = "^4.1"
pytest-asyncio = "^0.21"
pytest-mock = "^3.12"
hypothesis = "^6.92"  # åŸºäºå±æ€§çš„æµ‹è¯•
```

#### ä»£ç è´¨é‡
```toml
ruff = "^0.1"       # å¿«é€Ÿçš„ linter å’Œ formatter
mypy = "^1.7"       # é™æ€ç±»å‹æ£€æŸ¥
```

#### ä¼˜åŒ–ç®—æ³•
```toml
deap = "^1.4"       # é—ä¼ ç®—æ³•
bayesian-optimization = "^1.4"  # è´å¶æ–¯ä¼˜åŒ–
pyswarm = "^0.6"    # ç²’å­ç¾¤ä¼˜åŒ–
SALib = "^1.4"      # æ•æ„Ÿæ€§åˆ†æ
```

#### æ•°æ®å¤„ç†
```toml
pandas = "^2.1"
numpy = "^1.26"
polars = "^0.19"    # æ›´å¿«çš„ DataFrameï¼ˆå¯é€‰ï¼‰
```

### å¼€å‘å·¥å…·

#### IDE é…ç½®
- **VSCode** / **PyCharm Professional**
- æ’ä»¶ï¼š
  - Python
  - Pylanceï¼ˆç±»å‹æ£€æŸ¥ï¼‰
  - Ruffï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰
  - GitLens

#### ç‰ˆæœ¬æ§åˆ¶
```bash
git
pre-commit  # Git hooks
```

---

## æ¶æ„è®¾è®¡æ¦‚è§ˆ

### åˆ†å±‚æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å±‚ (Application)                      â”‚
â”‚  - CLI å…¥å£                                                   â”‚
â”‚  - æ‰¹å¤„ç†ç¼–æ’å™¨ (BatchOrchestrator)                           â”‚
â”‚  - è¿›åº¦ç›‘æ§ (ProgressMonitor)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡å±‚ (Service)                          â”‚
â”‚  - æ¨¡æ‹ŸæœåŠ¡ (BaselineService, PVService, etc.)               â”‚
â”‚  - ä¼˜åŒ–æœåŠ¡ (OptimizationService)                            â”‚
â”‚  - åˆ†ææœåŠ¡ (SensitivityService, DataAnalysisService)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é¢†åŸŸå±‚ (Domain)                           â”‚
â”‚  - é¢†åŸŸæ¨¡å‹ (Building, WeatherFile, SimulationJob)           â”‚
â”‚  - é¢†åŸŸæœåŠ¡ (ECMApplicator, PVSystemDesigner)                â”‚
â”‚  - å€¼å¯¹è±¡ (ECMParameters, Location, SimulationPeriod)        â”‚
â”‚  - ä»“å‚¨æ¥å£ (IBuildingRepository, IResultRepository)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘ implemented by
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                  â”‚
â”‚  - æ–‡ä»¶ç³»ç»Ÿè®¿é—® (FileSystemBuildingRepository)               â”‚
â”‚  - EnergyPlus è¿è¡Œå™¨ (EnergyPlusExecutor)                    â”‚
â”‚  - ç¼“å­˜å®ç° (MemoryCache, DiskCache)                         â”‚
â”‚  - æ—¥å¿—å®ç° (LoguruLogger)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å·¥å…·å±‚ (Utilities)                        â”‚
â”‚  - é…ç½®ç®¡ç† (ConfigManager, Settings)                        â”‚
â”‚  - å¹¶è¡Œæ‰§è¡Œå™¨ (ParallelExecutor)                             â”‚
â”‚  - éªŒè¯å™¨ (Validator)                                        â”‚
â”‚  - å¼‚å¸¸å®šä¹‰ (CustomExceptions)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡æ¨¡å¼åº”ç”¨

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | ä½ç½® |
|------|---------|------|
| **Factory** | åˆ›å»ºæœåŠ¡å®ä¾‹ | `ServiceFactory` |
| **Strategy** | ä¼˜åŒ–ç®—æ³• | `OptimizationStrategy` |
| **Builder** | æ„å»ºå¤æ‚å¯¹è±¡ | `SimulationJobBuilder` |
| **Repository** | æ•°æ®è®¿é—®æŠ½è±¡ | `IBuildingRepository` |
| **Observer** | äº‹ä»¶é€šçŸ¥ | `ISimulationObserver` |
| **Dependency Injection** | è§£è€¦ä¾èµ– | `DependencyContainer` |
| **Template Method** | æ¨¡æ‹Ÿæµç¨‹ | `BaseSimulationService` |

---

## å®æ–½è·¯çº¿å›¾

### æ€»è§ˆ

```text
Phase 1: åŸºç¡€æ¶æ„ (Week 1-2)
    â†“
Phase 2: æ ¸å¿ƒæœåŠ¡ (Week 3-4)
    â†“
Phase 3: åŸºç¡€è®¾æ–½ (Week 5-6)
    â†“
Phase 4: åº”ç”¨å±‚ (Week 7-8)
    â†“
Phase 5: é«˜çº§åŠŸèƒ½ (Week 9-10)
    â†“
Phase 6: æµ‹è¯•ä¼˜åŒ– (Week 11-12)
```

### å„é˜¶æ®µæ¦‚è§ˆ

| é˜¶æ®µ | å‘¨æœŸ | äº¤ä»˜ç‰© | å…³é”®é‡Œç¨‹ç¢‘ |
|------|------|--------|-----------|
| **Phase 1** | Week 1-2 | é¢†åŸŸå±‚ + é…ç½®ç®¡ç† | æ ¸å¿ƒå®ä½“å®šä¹‰å®Œæˆ |
| **Phase 2** | Week 3-4 | æœåŠ¡å±‚æ¥å£ + Baselineå®ç° | é¦–ä¸ªæ¨¡æ‹ŸæˆåŠŸè¿è¡Œ |
| **Phase 3** | Week 5-6 | åŸºç¡€è®¾æ–½ + ä»“å‚¨ | æ–‡ä»¶ç³»ç»Ÿä»“å‚¨å°±ç»ª |
| **Phase 4** | Week 7-8 | åº”ç”¨å±‚ + ç¼–æ’å™¨ | æ‰¹å¤„ç†åŠŸèƒ½å®Œæˆ |
| **Phase 5** | Week 9-10 | ä¼˜åŒ–æœåŠ¡ + PVæœåŠ¡ | é«˜çº§åŠŸèƒ½é›†æˆ |
| **Phase 6** | Week 11-12 | æµ‹è¯• + æ–‡æ¡£ | 80%æµ‹è¯•è¦†ç›– |

---

## å„é˜¶æ®µè¯¦ç»†è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„ (ç¬¬ 1-2 å‘¨)

#### ç›®æ ‡
æ„å»ºåšå®çš„é¢†åŸŸæ¨¡å‹å’Œé…ç½®ç®¡ç†åŸºç¡€

#### ä»»åŠ¡æ¸…å•

**Week 1: é¢†åŸŸæ¨¡å‹**
- [ ] **Day 1-2**: åˆ›å»ºç›®å½•ç»“æ„
  ```bash
  backend/
  â”œâ”€â”€ domain/
  â”‚   â”œâ”€â”€ models/
  â”‚   â”œâ”€â”€ value_objects/
  â”‚   â”œâ”€â”€ services/
  â”‚   â””â”€â”€ repositories/
  â”œâ”€â”€ services/
  â”œâ”€â”€ infrastructure/
  â”œâ”€â”€ application/
  â””â”€â”€ utils/
  ```

- [ ] **Day 3-4**: å®ç°æ ¸å¿ƒå®ä½“
  - `Building` å®ä½“
  - `WeatherFile` å®ä½“
  - `SimulationJob` å®ä½“
  - `SimulationResult` å®ä½“
  - æšä¸¾ç±»å‹ (`BuildingType`, `SimulationStatus`, etc.)

- [ ] **Day 5**: å®ç°å€¼å¯¹è±¡
  - `ECMParameters` å€¼å¯¹è±¡
  - `Location` å€¼å¯¹è±¡
  - `SimulationPeriod` å€¼å¯¹è±¡

**Week 2: é…ç½®å’Œå·¥å…·**
- [ ] **Day 1-2**: é…ç½®ç®¡ç†
  - åˆ›å»º `Settings` (Pydantic BaseSettings)
  - åˆ›å»º `PathsConfig`, `SimulationConfig` æ•°æ®ç±»
  - å®ç°é…ç½®éªŒè¯

- [ ] **Day 3**: ä¾èµ–æ³¨å…¥
  - åˆ›å»º `DependencyContainer`
  - å®ç°æœåŠ¡æ³¨å†Œ

- [ ] **Day 4**: å¼‚å¸¸ä½“ç³»
  - å®šä¹‰å¼‚å¸¸å±‚æ¬¡ç»“æ„
  - å®ç°è‡ªå®šä¹‰å¼‚å¸¸ç±»

- [ ] **Day 5**: å•å…ƒæµ‹è¯•
  - é¢†åŸŸæ¨¡å‹æµ‹è¯•
  - é…ç½®ç®¡ç†æµ‹è¯•

#### äº¤ä»˜ç‰©
âœ… å®Œæ•´çš„é¢†åŸŸæ¨¡å‹
âœ… ç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç†
âœ… ä¾èµ–æ³¨å…¥å®¹å™¨
âœ… 80%+ å•å…ƒæµ‹è¯•è¦†ç›–

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰é¢†åŸŸç±»æœ‰100%ç±»å‹æç¤º
- [ ] æ‰€æœ‰ç±»æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- [ ] mypy æ£€æŸ¥é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

---

### Phase 2: æ ¸å¿ƒæœåŠ¡ (ç¬¬ 3-4 å‘¨)

#### ç›®æ ‡
å®ç°åŸºç¡€æ¨¡æ‹ŸæœåŠ¡å’ŒEnergyPlusé›†æˆ

#### ä»»åŠ¡æ¸…å•

**Week 3: æœåŠ¡æ¥å£å’ŒåŸºç¡€æœåŠ¡**
- [ ] **Day 1-2**: å®šä¹‰æœåŠ¡æ¥å£
  - `ISimulationService` æ¥å£
  - `IFileLoader` æ¥å£
  - `IResultProcessor` æ¥å£
  - `IEnergyPlusExecutor` æ¥å£

- [ ] **Day 3-4**: å®ç° BaselineService
  - åˆ›å»º `BaseSimulationService` æŠ½è±¡ç±»
  - å®ç° `BaselineSimulationService`
  - å®ç°æ¨¡æ‹Ÿä¸Šä¸‹æ–‡ (`SimulationContext`)

- [ ] **Day 5**: æ–‡ä»¶åŠ è½½å™¨
  - å®ç° `IDFFileLoader`
  - å®ç° `EPWFileLoader`
  - å®ç°æ–‡ä»¶éªŒè¯é€»è¾‘

**Week 4: EnergyPlus é›†æˆ**
- [ ] **Day 1-3**: EnergyPlus æ‰§è¡Œå™¨
  - å®ç° `EnergyPlusExecutor`
  - å¤„ç† eppy API è°ƒç”¨
  - å®ç°é”™è¯¯å¤„ç†

- [ ] **Day 4**: ç»“æœè§£æå™¨
  - å®ç° `ResultParser`
  - è§£æ Table CSV
  - è§£æ Meter CSV
  - æå– EUI

- [ ] **Day 5**: é›†æˆæµ‹è¯•
  - ç«¯åˆ°ç«¯æ¨¡æ‹Ÿæµ‹è¯•
  - æ–‡ä»¶åŠ è½½æµ‹è¯•

#### äº¤ä»˜ç‰©
âœ… æœåŠ¡å±‚æ¥å£å®šä¹‰
âœ… BaselineService å®Œæ•´å®ç°
âœ… EnergyPlus æ‰§è¡Œå™¨
âœ… ç»“æœè§£æå™¨

#### éªŒæ”¶æ ‡å‡†
- [ ] èƒ½æˆåŠŸè¿è¡ŒåŸºå‡†æ¨¡æ‹Ÿ
- [ ] æ­£ç¡®è§£ææ¨¡æ‹Ÿç»“æœ
- [ ] æœåŠ¡å±‚å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

---

### Phase 3: åŸºç¡€è®¾æ–½å±‚ (ç¬¬ 5-6 å‘¨)

#### ç›®æ ‡
å®ç°ä»“å‚¨æ¨¡å¼ã€ç¼“å­˜ç³»ç»Ÿå’Œæ—¥å¿—ç³»ç»Ÿ

#### ä»»åŠ¡æ¸…å•

**Week 5: ä»“å‚¨æ¨¡å¼**
- [ ] **Day 1-2**: ä»“å‚¨æ¥å£
  - `IBuildingRepository`
  - `IWeatherRepository`
  - `IResultRepository`

- [ ] **Day 3-5**: æ–‡ä»¶ç³»ç»Ÿä»“å‚¨å®ç°
  - `FileSystemBuildingRepository`
  - `FileSystemWeatherRepository`
  - `FileSystemResultRepository`

**Week 6: ç¼“å­˜å’Œæ—¥å¿—**
- [ ] **Day 1-2**: ç¼“å­˜ç³»ç»Ÿ
  - å®ç° `MemoryCache`
  - å®ç° `DiskCache` (diskcache)
  - å®ç° `SmartCache` (æ··åˆç¼“å­˜)

- [ ] **Day 3-4**: æ—¥å¿—ç³»ç»Ÿ
  - é…ç½® Loguru
  - å®ç° `ILogger` æ¥å£
  - å®ç° `LoguruLogger`
  - é…ç½®æ—¥å¿—æ ¼å¼å’Œè½®è½¬

- [ ] **Day 5**: å·¥å‚æ¨¡å¼
  - å®ç° `ServiceFactory`
  - å®ç° `BuildingFactory`
  - å®ç° `WeatherFactory`

#### äº¤ä»˜ç‰©
âœ… ä»“å‚¨æ¨¡å¼å®ç°
âœ… ç¼“å­˜ç³»ç»Ÿ
âœ… æ—¥å¿—ç³»ç»Ÿ
âœ… å·¥å‚æ¨¡å¼

#### éªŒæ”¶æ ‡å‡†
- [ ] ä»“å‚¨èƒ½æ­£ç¡®åŠ è½½å’Œä¿å­˜æ•°æ®
- [ ] ç¼“å­˜ç³»ç»ŸåŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å¿—è¾“å‡ºæ ¼å¼æ­£ç¡®
- [ ] å·¥å‚èƒ½åˆ›å»ºæ­£ç¡®çš„å®ä¾‹

---

### Phase 4: åº”ç”¨å±‚ (ç¬¬ 7-8 å‘¨)

#### ç›®æ ‡
å®ç°æ‰¹å¤„ç†ç¼–æ’å™¨å’Œå¹¶è¡Œæ‰§è¡Œ

#### ä»»åŠ¡æ¸…å•

**Week 7: ç¼–æ’å™¨**
- [ ] **Day 1-3**: æ¨¡æ‹Ÿç¼–æ’å™¨
  - å®ç° `SimulationOrchestrator`
  - å®ç°æ‰¹é‡æ‰§è¡Œé€»è¾‘
  - é›†æˆç¼“å­˜æœºåˆ¶
  - å®ç°è¿›åº¦è·Ÿè¸ª

- [ ] **Day 4-5**: å»ºé€ è€…æ¨¡å¼
  - å®ç° `SimulationJobBuilder`
  - å®ç°æµå¼ API

**Week 8: å¹¶è¡Œæ‰§è¡Œå’Œè§‚å¯Ÿè€…**
- [ ] **Day 1-3**: å¹¶è¡Œæ‰§è¡Œå™¨
  - å®ç° `ParallelExecutor`
  - æ”¯æŒå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹
  - å®ç°åˆ†å—æ‰§è¡Œ

- [ ] **Day 4-5**: è§‚å¯Ÿè€…æ¨¡å¼
  - å®šä¹‰ `ISimulationObserver` æ¥å£
  - å®ç° `LoggerObserver`
  - å®ç° `ProgressBarObserver`
  - é›†æˆåˆ°ç¼–æ’å™¨

#### äº¤ä»˜ç‰©
âœ… æ‰¹å¤„ç†ç¼–æ’å™¨
âœ… å¹¶è¡Œæ‰§è¡Œå™¨
âœ… è§‚å¯Ÿè€…æ¨¡å¼å®ç°
âœ… å»ºé€ è€…æ¨¡å¼å®ç°

#### éªŒæ”¶æ ‡å‡†
- [ ] èƒ½å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæ¨¡æ‹Ÿ
- [ ] è¿›åº¦æ­£ç¡®æ˜¾ç¤º
- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
- [ ] æ€§èƒ½è¾¾åˆ°é¢„æœŸï¼ˆ4-8xï¼‰

---

### Phase 5: é«˜çº§åŠŸèƒ½ (ç¬¬ 9-10 å‘¨)

#### ç›®æ ‡
å®ç°ä¼˜åŒ–æœåŠ¡ã€PVæœåŠ¡å’Œæ•æ„Ÿæ€§åˆ†æ

#### ä»»åŠ¡æ¸…å•

**Week 9: ä¼˜åŒ–æœåŠ¡**
- [ ] **Day 1-2**: ä¼˜åŒ–ç­–ç•¥æ¥å£
  - å®šä¹‰ `IOptimizationStrategy`
  - å®šä¹‰ç›®æ ‡å‡½æ•°æ¥å£

- [ ] **Day 3**: é—ä¼ ç®—æ³•
  - å®ç° `GeneticAlgorithmStrategy` (DEAP)
  - é…ç½® GA å‚æ•°

- [ ] **Day 4**: è´å¶æ–¯ä¼˜åŒ–
  - å®ç° `BayesianOptimizationStrategy`
  - é›†æˆ bayesian-optimization

- [ ] **Day 5**: ä¼˜åŒ–æœåŠ¡
  - å®ç° `OptimizationService`
  - é›†æˆå¤šç§ç­–ç•¥

**Week 10: PV å’Œæ•æ„Ÿæ€§åˆ†æ**
- [ ] **Day 1-2**: PV æœåŠ¡
  - å®ç° `PVSystemDesigner` é¢†åŸŸæœåŠ¡
  - å®ç° `PVSimulationService`
  - IDF PV å¯¹è±¡ç”Ÿæˆ

- [ ] **Day 3-4**: æ•æ„Ÿæ€§åˆ†æ
  - å®ç° `SensitivityService`
  - é›†æˆ SALib
  - æ”¯æŒ Sobol å’Œ Morris æ–¹æ³•

- [ ] **Day 5**: CLI å…¥å£
  - å®ç° CLI å‘½ä»¤
  - å‚æ•°è§£æ
  - å¸®åŠ©æ–‡æ¡£

#### äº¤ä»˜ç‰©
âœ… ä¼˜åŒ–æœåŠ¡ï¼ˆå¤šç§ç®—æ³•ï¼‰
âœ… PV æ¨¡æ‹ŸæœåŠ¡
âœ… æ•æ„Ÿæ€§åˆ†ææœåŠ¡
âœ… CLI å…¥å£

#### éªŒæ”¶æ ‡å‡†
- [ ] ä¼˜åŒ–ç®—æ³•èƒ½æ‰¾åˆ°æœ€ä¼˜è§£
- [ ] PV ç³»ç»Ÿæ­£ç¡®æ·»åŠ åˆ° IDF
- [ ] æ•æ„Ÿæ€§åˆ†æç»“æœæ­£ç¡®
- [ ] CLI æ˜“äºä½¿ç”¨

---

### Phase 6: æµ‹è¯•å’Œä¼˜åŒ– (ç¬¬ 11-12 å‘¨)

#### ç›®æ ‡
å®Œå–„æµ‹è¯•å¥—ä»¶ã€æ€§èƒ½ä¼˜åŒ–å’Œæ–‡æ¡£

#### ä»»åŠ¡æ¸…å•

**Week 11: æµ‹è¯•**
- [ ] **Day 1-2**: å•å…ƒæµ‹è¯•è¡¥å……
  - è¡¥å……é—æ¼çš„å•å…ƒæµ‹è¯•
  - è¾¾åˆ° 80%+ è¦†ç›–ç‡

- [ ] **Day 3-4**: é›†æˆæµ‹è¯•
  - ç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•
  - æµ‹è¯•æ‰€æœ‰æ ¸å¿ƒæµç¨‹

- [ ] **Day 5**: æ€§èƒ½æµ‹è¯•
  - ç¼–å†™æ€§èƒ½åŸºå‡†æµ‹è¯•
  - æµ‹é‡å¹¶è¡Œæ‰§è¡Œæ•ˆç‡
  - æµ‹é‡ç¼“å­˜å‘½ä¸­ç‡

**Week 12: ä¼˜åŒ–å’Œæ–‡æ¡£**
- [ ] **Day 1-2**: æ€§èƒ½ä¼˜åŒ–
  - æ ¹æ®åŸºå‡†æµ‹è¯•ä¼˜åŒ–ç“¶é¢ˆ
  - è°ƒæ•´å¹¶è¡Œå‚æ•°
  - ä¼˜åŒ–ç¼“å­˜ç­–ç•¥

- [ ] **Day 3-4**: æ–‡æ¡£å®Œå–„
  - API æ–‡æ¡£ç”Ÿæˆ
  - ä½¿ç”¨ç¤ºä¾‹
  - æ¶æ„æ–‡æ¡£

- [ ] **Day 5**: éƒ¨ç½²å‡†å¤‡
  - æ‰“åŒ…é…ç½® (pyproject.toml)
  - Docker é…ç½®ï¼ˆå¯é€‰ï¼‰
  - éƒ¨ç½²æ–‡æ¡£

#### äº¤ä»˜ç‰©
âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶ (80%+ è¦†ç›–)
âœ… æ€§èƒ½ä¼˜åŒ–å®Œæˆ
âœ… å®Œæ•´æ–‡æ¡£
âœ… éƒ¨ç½²å°±ç»ª

#### éªŒæ”¶æ ‡å‡†
- [ ] pytest æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] è¦†ç›–ç‡ > 80%
- [ ] æ€§èƒ½è¾¾æ ‡ï¼ˆ4-8x æå‡ï¼‰
- [ ] æ–‡æ¡£å®Œæ•´æ¸…æ™°

---

## è´¨é‡ä¿è¯

### ä»£ç è´¨é‡

#### é™æ€æ£€æŸ¥

```bash
# mypy - ç±»å‹æ£€æŸ¥
mypy backend/ --strict

# ruff - Lint å’Œæ ¼å¼åŒ–
ruff check backend/
ruff format backend/

# pytest - æµ‹è¯•
pytest tests/ --cov=backend --cov-report=html
```

#### CI/CD æµæ°´çº¿

```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      - run: pip install poetry
      - run: poetry install
      - run: poetry run mypy backend/
      - run: poetry run ruff check backend/
      - run: poetry run pytest tests/ --cov=backend
```

### ä»£ç å®¡æŸ¥

#### å®¡æŸ¥æ¸…å•

**æ¶æ„å±‚é¢**
- [ ] æ˜¯å¦éµå¾ªåˆ†å±‚æ¶æ„ï¼Ÿ
- [ ] æ˜¯å¦åº”ç”¨äº†é€‚å½“çš„è®¾è®¡æ¨¡å¼ï¼Ÿ
- [ ] ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®ï¼Ÿ

**ä»£ç å±‚é¢**
- [ ] æ˜¯å¦æœ‰å®Œæ•´çš„ç±»å‹æç¤ºï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ–‡æ¡£å­—ç¬¦ä¸²ï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªå‘½åè§„èŒƒï¼Ÿ
- [ ] æ˜¯å¦æœ‰å•å…ƒæµ‹è¯•ï¼Ÿ

**SOLID åŸåˆ™**
- [ ] å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰
- [ ] å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰
- [ ] é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰
- [ ] æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰
- [ ] ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰

### æ€§èƒ½æŒ‡æ ‡

#### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æµ‹é‡æ–¹æ³• | ç›®æ ‡ |
|------|---------|------|
| **æ¨¡æ‹Ÿé€Ÿåº¦** | æ—¶é—´æµ‹é‡ | å•ä¸ªæ¨¡æ‹Ÿ < 50s |
| **å¹¶è¡Œæ•ˆç‡** | åŠ é€Ÿæ¯” | 4-8x æå‡ |
| **ç¼“å­˜å‘½ä¸­ç‡** | è®¡æ•°å™¨ | > 80% |
| **å†…å­˜ä½¿ç”¨** | å†…å­˜åˆ†æå™¨ | < 2GB |
| **CPU åˆ©ç”¨ç‡** | ç³»ç»Ÿç›‘æ§ | 80-90% |

#### æ€§èƒ½æµ‹è¯•

```python
# tests/performance/test_baseline_performance.py
import time
import pytest
from backend.application import SimulationOrchestrator

def test_parallel_performance(benchmark_jobs):
    """æµ‹è¯•å¹¶è¡Œæ‰§è¡Œæ€§èƒ½"""
    orchestrator = SimulationOrchestrator(max_workers=8)

    start = time.time()
    results = orchestrator.execute_batch(benchmark_jobs)
    elapsed = time.time() - start

    # åº”è¯¥æ¯”é¡ºåºæ‰§è¡Œå¿« 4-8 å€
    assert elapsed < len(benchmark_jobs) * 60 / 4
```

---

## é£é™©ç®¡ç†

### è¯†åˆ«çš„é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| **EnergyPlus API å˜åŒ–** | é«˜ | ä¸­ | å›ºå®š eppy ç‰ˆæœ¬ï¼Œæµ‹è¯•è¦†ç›– |
| **æ€§èƒ½ç›®æ ‡æœªè¾¾æˆ** | ä¸­ | ä½ | æ—©æœŸæ€§èƒ½æµ‹è¯•ï¼Œè¿­ä»£ä¼˜åŒ– |
| **ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§** | ä¸­ | ä½ | ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œç‰ˆæœ¬é”å®š |
| **æ—¶é—´è¶…æœŸ** | é«˜ | ä¸­ | æ•æ·è¿­ä»£ï¼ŒMVP å…ˆè¡Œ |
| **æ•°æ®è¿ç§»é—®é¢˜** | ä½ | ä½ | å®Œå…¨é‡å†™ï¼Œæ— éœ€è¿ç§» |

### åº”å¯¹ç­–ç•¥

#### æŠ€æœ¯é£é™©

**é£é™©**: EnergyPlus/eppy ç‰ˆæœ¬ä¸å…¼å®¹

**ç¼“è§£**:
1. å›ºå®š eppy ç‰ˆæœ¬ï¼š`eppy==0.5.63`
2. å®Œæ•´çš„é›†æˆæµ‹è¯•è¦†ç›–
3. éš”ç¦» eppy è°ƒç”¨åˆ°ä¸“é—¨çš„æ‰§è¡Œå™¨ç±»

**é£é™©**: å¹¶è¡Œæ‰§è¡Œæ€§èƒ½ä¸è¾¾æ ‡

**ç¼“è§£**:
1. Phase 4 æ—©æœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•
2. åˆ†æç“¶é¢ˆï¼Œä¼˜åŒ–å…³é”®è·¯å¾„
3. è€ƒè™‘å¤šç§å¹¶è¡Œç­–ç•¥ï¼ˆè¿›ç¨‹ vs çº¿ç¨‹ï¼‰

#### è¿›åº¦é£é™©

**é£é™©**: å¼€å‘æ—¶é—´è¶…æœŸ

**ç¼“è§£**:
1. æ¯å‘¨æ£€æŸ¥è¿›åº¦
2. MVP ä¼˜å…ˆï¼ˆPhase 1-4 ä¸ºæ ¸å¿ƒï¼‰
3. Phase 5-6 ä¸ºå¢å¼ºåŠŸèƒ½ï¼Œå¯å»¶å

---

## æ–‡æ¡£ç»“æ„

### å®æ–½æ–‡æ¡£æ¸…å•

æœ¬é‡æ„è®¡åˆ’åŒ…å«ä»¥ä¸‹è¯¦ç»†å®æ–½æ–‡æ¡£ï¼š

#### ğŸ“„ å·²å®Œæˆ

1. **00_REFACTORING_PLAN.md** (æœ¬æ–‡æ¡£)
   - æ€»ä½“è®¡åˆ’å’Œè·¯çº¿å›¾

2. **01_DOMAIN_LAYER.md**
   - é¢†åŸŸå±‚å®ç°æŒ‡å—

#### ğŸ“„ å¾…åˆ›å»º

3. **02_SERVICE_LAYER.md**
   - æœåŠ¡å±‚æ¥å£è®¾è®¡
   - BaselineService è¯¦ç»†å®ç°
   - ä¼˜åŒ–æœåŠ¡å’Œç­–ç•¥æ¨¡å¼
   - æœåŠ¡å·¥å‚

4. **03_INFRASTRUCTURE_LAYER.md**
   - EnergyPlus æ‰§è¡Œå™¨
   - æ–‡ä»¶ç³»ç»Ÿä»“å‚¨
   - ç¼“å­˜å®ç°ï¼ˆå†…å­˜ + ç£ç›˜ï¼‰
   - æ—¥å¿—ç³»ç»Ÿ

5. **04_APPLICATION_LAYER.md**
   - æ‰¹å¤„ç†ç¼–æ’å™¨
   - å¹¶è¡Œæ‰§è¡Œå™¨
   - CLI å…¥å£
   - è§‚å¯Ÿè€…æ¨¡å¼

6. **05_REPOSITORY_LAYER.md**
   - ä»“å‚¨æ¨¡å¼è¯¦è§£
   - æ–‡ä»¶ç³»ç»Ÿä»“å‚¨
   - æ•°æ®åº“ä»“å‚¨ï¼ˆå¯é€‰ï¼‰

7. **06_UTILITIES_LAYER.md**
   - é…ç½®ç®¡ç†ï¼ˆPydantic Settingsï¼‰
   - ä¾èµ–æ³¨å…¥å®¹å™¨
   - éªŒè¯å™¨
   - å¼‚å¸¸ä½“ç³»

8. **07_TESTING_STRATEGY.md**
   - å•å…ƒæµ‹è¯•æŒ‡å—
   - é›†æˆæµ‹è¯•æŒ‡å—
   - æ€§èƒ½æµ‹è¯•
   - æµ‹è¯•å¤¹å…·

9. **08_PERFORMANCE_OPTIMIZATION.md**
   - å¹¶è¡Œæ‰§è¡Œç­–ç•¥
   - ç¼“å­˜ç­–ç•¥
   - å¯¹è±¡æ± åŒ–
   - æ€§èƒ½åˆ†æå·¥å…·

### æ–‡æ¡£ä½¿ç”¨æŒ‡å—

#### é˜…è¯»é¡ºåº

**æ–°å¼€å‘è€…**:
```text
00 æ€»ä½“è®¡åˆ’ â†’ 01 é¢†åŸŸå±‚ â†’ 02 æœåŠ¡å±‚ â†’ 06 å·¥å…·å±‚ â†’
03 åŸºç¡€è®¾æ–½ â†’ 04 åº”ç”¨å±‚ â†’ 07 æµ‹è¯•ç­–ç•¥
```

**æ¶æ„å¸ˆ**:
```text
00 æ€»ä½“è®¡åˆ’ â†’ æ¶æ„å›¾ â†’ å„å±‚æ–‡æ¡£æ¦‚è§ˆ
```

**å®æ–½å¼€å‘**:
æŒ‰ Phase é¡ºåºï¼šPhase 1 â†’ Phase 2 â†’ ... â†’ Phase 6

---

## æˆåŠŸæ ‡å‡†

### æœ€ç»ˆéªŒæ”¶æ ‡å‡†

#### åŠŸèƒ½æ€§æ ‡å‡†

- [ ] âœ… èƒ½æ‰§è¡ŒåŸºå‡†å»ºç­‘æ¨¡æ‹Ÿ
- [ ] âœ… èƒ½æ‰§è¡Œ PV ç³»ç»Ÿæ¨¡æ‹Ÿ
- [ ] âœ… èƒ½æ‰§è¡Œ ECM å‚æ•°åŒ–æ¨¡æ‹Ÿ
- [ ] âœ… èƒ½æ‰§è¡Œä¼˜åŒ–ï¼ˆGA, BOï¼‰
- [ ] âœ… èƒ½æ‰§è¡Œæ•æ„Ÿæ€§åˆ†æ
- [ ] âœ… æ”¯æŒæ‰¹é‡å¹¶è¡Œå¤„ç†
- [ ] âœ… æ­£ç¡®è§£æå’Œå­˜å‚¨ç»“æœ

#### è´¨é‡æ ‡å‡†

**ä»£ç è´¨é‡**
- [ ] âœ… 100% ç±»å‹æç¤ºè¦†ç›–
- [ ] âœ… mypy --strict æ£€æŸ¥é€šè¿‡
- [ ] âœ… ruff æ£€æŸ¥æ— é”™è¯¯
- [ ] âœ… 90%+ æ–‡æ¡£å­—ç¬¦ä¸²è¦†ç›–
- [ ] âœ… ä»£ç é‡å¤ç‡ < 3%
- [ ] âœ… åœˆå¤æ‚åº¦ < 10

**æµ‹è¯•**
- [ ] âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] âœ… é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
- [ ] âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡

**æ€§èƒ½**
- [ ] âœ… å¹¶è¡Œæ‰§è¡ŒåŠ é€Ÿ 4-8x
- [ ] âœ… ç¼“å­˜å‘½ä¸­ç‡ > 80%
- [ ] âœ… å•ä¸ªæ¨¡æ‹Ÿ < 50s

**æ–‡æ¡£**
- [ ] âœ… æ‰€æœ‰æ¨¡å—æœ‰å®æ–½æ–‡æ¡£
- [ ] âœ… API æ–‡æ¡£å®Œæ•´
- [ ] âœ… ä½¿ç”¨ç¤ºä¾‹é½å…¨

### éªŒæ”¶æµ‹è¯•

#### ç«¯åˆ°ç«¯æµ‹è¯•

```python
def test_full_workflow():
    """ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•"""
    # 1. åŠ è½½é…ç½®
    config = ConfigManager()

    # 2. åˆ›å»ºä¾èµ–å®¹å™¨
    container = setup_container(config)

    # 3. åˆ›å»ºå»ºç­‘å’Œå¤©æ°”æ–‡ä»¶
    building = BuildingFactory.create_from_idf(...)
    weather = WeatherFactory.create(...)

    # 4. åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡
    job = (SimulationJobBuilder()
        .with_building(building)
        .with_weather_file(weather)
        .with_simulation_type("baseline")
        .build())

    # 5. æ‰§è¡Œæ¨¡æ‹Ÿ
    orchestrator = container.resolve(SimulationOrchestrator)
    results = orchestrator.execute_batch([job])

    # 6. éªŒè¯ç»“æœ
    assert len(results) == 1
    assert results[0].success
    assert results[0].source_eui > 0
```

#### æ€§èƒ½åŸºå‡†æµ‹è¯•

```python
def test_performance_benchmark():
    """æ€§èƒ½åŸºå‡†æµ‹è¯•"""
    jobs = create_100_jobs()  # 100 ä¸ªæ¨¡æ‹Ÿä»»åŠ¡

    # é¡ºåºæ‰§è¡ŒåŸºå‡†
    start = time.time()
    sequential_results = run_sequential(jobs)
    sequential_time = time.time() - start

    # å¹¶è¡Œæ‰§è¡Œ
    start = time.time()
    parallel_results = orchestrator.execute_batch(jobs, max_workers=8)
    parallel_time = time.time() - start

    # éªŒè¯åŠ é€Ÿæ¯”
    speedup = sequential_time / parallel_time
    assert speedup >= 4.0  # è‡³å°‘ 4 å€åŠ é€Ÿ

    # éªŒè¯ç»“æœä¸€è‡´æ€§
    assert compare_results(sequential_results, parallel_results)
```

---

## æ€»ç»“

### é‡æ„ä»·å€¼

æœ¬æ¬¡é‡æ„å°†ä¸º EP-WebUI å¸¦æ¥ï¼š

1. **æŠ€æœ¯ä»·å€¼**
   - æ¸…æ™°çš„æ¶æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
   - é«˜æ€§èƒ½ï¼Œ4-8x æ‰§è¡Œé€Ÿåº¦æå‡
   - é«˜è´¨é‡ï¼Œ80%+ æµ‹è¯•è¦†ç›–

2. **ä¸šåŠ¡ä»·å€¼**
   - æ›´å¿«çš„ç ”ç©¶è¿­ä»£å‘¨æœŸ
   - æ›´å¯é çš„æ¨¡æ‹Ÿç»“æœ
   - æ›´å®¹æ˜“æ·»åŠ æ–°åŠŸèƒ½

3. **å›¢é˜Ÿä»·å€¼**
   - å®Œæ•´çš„æ–‡æ¡£ï¼Œé™ä½å­¦ä¹ æˆæœ¬
   - æ¸…æ™°çš„ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡
   - å…¨é¢çš„æµ‹è¯•ï¼Œå¢å¼ºä¿¡å¿ƒ

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: Phase 1 - åˆ›å»ºç›®å½•ç»“æ„
2. **æœ¬å‘¨ç›®æ ‡**: å®Œæˆé¢†åŸŸæ¨¡å‹å®ç°
3. **æœ¬æœˆç›®æ ‡**: å®Œæˆ Phase 1-2

### æŒç»­æ”¹è¿›

é‡æ„å®Œæˆåï¼Œç»§ç»­ï¼š
- ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- è¿­ä»£ä¼˜åŒ–
- æ·»åŠ æ–°åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2025-10-27
**ä½œè€…**: EP-WebUI Team
**å®¡é˜…**: [å¾…å®¡é˜…]

---

## é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **DDD** | Domain-Driven Designï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡ |
| **SOLID** | é¢å‘å¯¹è±¡è®¾è®¡çš„äº”ä¸ªåŸºæœ¬åŸåˆ™ |
| **EUI** | Energy Use Intensityï¼Œèƒ½è€—å¼ºåº¦ï¼ˆkWh/mÂ²/yrï¼‰ |
| **ECM** | Energy Conservation Measuresï¼Œèƒ½æ•ˆæªæ–½ |
| **TMY** | Typical Meteorological Yearï¼Œå…¸å‹æ°”è±¡å¹´ |
| **FTMY** | Future Typical Meteorological Yearï¼Œæœªæ¥å…¸å‹æ°”è±¡å¹´ |
| **PV** | Photovoltaicï¼Œå…‰ä¼ç³»ç»Ÿ |
| **GA** | Genetic Algorithmï¼Œé—ä¼ ç®—æ³• |
| **BO** | Bayesian Optimizationï¼Œè´å¶æ–¯ä¼˜åŒ– |
| **PSO** | Particle Swarm Optimizationï¼Œç²’å­ç¾¤ä¼˜åŒ– |

### B. å‚è€ƒèµ„æº

**Python**
- [Python Type Hints](https://docs.python.org/3/library/typing.html)
- [Pydantic V2 Docs](https://docs.pydantic.dev/latest/)

**æ¶æ„**
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Domain-Driven Design](https://martinfowler.com/bliki/DomainDrivenDesign.html)

**è®¾è®¡æ¨¡å¼**
- [Refactoring Guru](https://refactoring.guru/design-patterns)

**EnergyPlus**
- [EnergyPlus Documentation](https://energyplus.net/documentation)
- [eppy Documentation](https://eppy.readthedocs.io/)

### C. è”ç³»æ–¹å¼

**é¡¹ç›®å›¢é˜Ÿ**
- é¡¹ç›®è´Ÿè´£äºº: [å§“å]
- æŠ€æœ¯è´Ÿè´£äºº: [å§“å]
- æ¶æ„å¸ˆ: [å§“å]

**æ”¯æŒæ¸ é“**
- GitHub Issues: [URL]
- Email: [email]
- Slack: [channel]

---

**End of Document**
